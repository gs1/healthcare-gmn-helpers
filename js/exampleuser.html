<!DOCTYPE html>

<!--
  GMN check digit generator and verifier example.

  (c) 2019 GS1 AISBL. All rights reserved.
-->

<html lang="en">

<head>

<meta charset="UTF-8">
<title>GS1 Healthcare GMN JavaScript Helper Example</title>

<!-- Include the library -->
<script src="healthcaregmn.js"></script>

<script>

/*
 * Example error handler
 *
 * err:      The exception that was raised
 * input:    A partial or complete GMN as supplied.
 * complete: True if input represents a complete GMN, i.e. for verify.
 *
 */
function _handleerror(err,input,complete)
{

    // Something went wrong due to incorrect input. Indicate the source of the error to the user.
    var output = err;
    var shoutout = "";

    var goodCharacters = HealthcareGMN.goodCharacterPositions(input,complete);
    for (var i = 0; i < input.length; i++)
        shoutout +=  goodCharacters[i] ? input[i] : '<span style="color: #f00">' + input[i] + '</span>';

    document.getElementById("output").value = output;
    document.getElementById("shoutout").innerHTML = shoutout;

}


/*
 *  Example: HealthcareGMN.verifyCheckCharacters
 *
 *  Verifying the check characters of a GMN.
 *
 */
function verify ()
{

    var input = document.getElementById("input").value;

    var output;
    var shoutout;
    try
    {

        // If verifyCheckCharacters returns true then all is well...
        if (HealthcareGMN.verifyCheckCharacters(input)) {
            output = "Valid"
            shoutout = input;
        } else {  // Otherwise the user-provided GMN is incorrect

            // We strip the provided check character pair from the input...
            var part = input.substring(0, input.length - 2);

            // ... calculate the correct check character pair and show the user
            var correctChecks = HealthcareGMN.checkCharacters(part);
            output = "Not valid";
            shoutout = part + '<span style="color: #f00">' + correctChecks + "</span>";

        }

        document.getElementById("output").value = output;
        document.getElementById("shoutout").innerHTML = shoutout;

    }
    catch (err)
    {
        _handleerror(err,input,true);
    }

}


/*
 *  Example: HealthcareGMN.addCheckCharacters
 *
 *  Adding the check characters to an incomplete GMN.
 *
 */
function addChecks ()
{

    var input = document.getElementById("input").value;

    try
    {
        var output = HealthcareGMN.addCheckCharacters(input);
        var shoutout = input +
                       '<span style="color: #f00">' +
                       output.substring(output.length-2,output.length) +
                       "</span>";
        document.getElementById("output").value = output;
        document.getElementById("shoutout").innerHTML = shoutout;
    }
    catch (err)
    {
        _handleerror(err,input,false);
    }

}


/*
 *  Example: HealthcareGMN.checkCharacters
 *
 *  Returning just the check characters.
 *
 */
function showChecks ()
{

    var input = document.getElementById("input").value;

    try
    {
        var output = HealthcareGMN.checkCharacters(input);
        var shoutout = input +
                       '<span style="color: #f00">' + output + "</span>";
        document.getElementById("output").value = output;
        document.getElementById("shoutout").innerHTML = shoutout;
    }
    catch (err)
    {
        _handleerror(err,input,false);
    }

}

</script>

</head>

<body>

<h1>GS1 Healthcare GMN</h1>

<h2>JavaScript Helper Library Example</h2>

<table>

<tr>
<td><label for="input">Input:</label></td>
<td>
<input id="input" type="text" size="35">


<!-- Link each button's onclick action to a function of the helper library -->

<button onclick="verify()">Verify</button>
<button onclick="addChecks()">Add Checks</button>
<button onclick="showChecks()">Show Checks</button>


</td>
</tr>

<tr>
<td><label for="output">Output:</label></td>
<td>
<input id="output" type="text" size="35" readonly>
</td>
</tr>

</table>

<br />

<span id="shoutout" style="font-size: 2em; font-family: mono"></span>

</body>

</html>
